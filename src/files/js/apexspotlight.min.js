var apexSpotlight={DOT:".",SP_DIALOG:"apx-Spotlight",SP_INPUT:"apx-Spotlight-input",SP_RESULTS:"apx-Spotlight-results",SP_ACTIVE:"is-active",SP_SHORTCUT:"apx-Spotlight-shortcut",SP_ACTION_SHORTCUT:"spotlight-search",SP_RESULT_LABEL:"apx-Spotlight-label",SP_LIVE_REGION:"sp-aria-match-found",SP_LIST:"sp-result-list",KEYS:$.ui.keyCode,URL_TYPES:{redirect:"redirect",searchPage:"search-page"},ICONS:{page:"fa-window-search",search:"icon-search"},gMaxNavResult:50,gWidth:650,gHasDialogCreated:!1,gSearchIndex:[],gKeywords:"",gAjaxIdentifier:null,gPlaceholderText:null,gMoreCharsText:null,gNoMatchText:null,gOneMatchText:null,gMultipleMatchesText:null,gInPageSearchText:null,gEnableInPageSearch:!0,gEnableDataCache:!1,gSubmitItemsArray:[],gKeyboardShortcutsArray:[],getSpotlightData:function(t){var e;if(apexSpotlight.gEnableDataCache&&(e=apexSpotlight.getSpotlightDataSessionStorage()))t(JSON.parse(e));else try{apex.server.plugin(apexSpotlight.gAjaxIdentifier,{pageItems:apexSpotlight.gSubmitItemsArray},{dataType:"json",success:function(e){apex.event.trigger("body","apexspotlight-ajax-success",e),apexSpotlight.gEnableDataCache&&apexSpotlight.setSpotlightDataSessionStorage(JSON.stringify(e)),t(e)},error:function(e,a){apex.event.trigger("body","apexspotlight-ajax-error",{message:a}),apex.debug.log("apexSpotlight.getSpotlightData AJAX Error",a),t([])}})}catch(e){apex.event.trigger("body","apexspotlight-ajax-error",{message:e}),t([])}},setSpotlightDataSessionStorage:function(t){if(apex.storage.hasSessionStorageSupport){var e=$v("pInstance");apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).setItem(e+".data",t)}},getSpotlightDataSessionStorage:function(){var t;if(apex.storage.hasSessionStorageSupport){var e=$v("pInstance");t=apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).getItem(e+".data")}return t},handleAriaAttr:function(){var t=$(apexSpotlight.DOT+apexSpotlight.SP_RESULTS),e=$(apexSpotlight.DOT+apexSpotlight.SP_INPUT),a=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE).find(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("id"),i=$("#"+a),p=i.text(),o=t.find("li"),l=0!==o.length,g="",h=o.filter(function(){return 0===$(this).find(apexSpotlight.DOT+apexSpotlight.SP_SHORTCUT).length}).length;$(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("aria-selected","false"),i.attr("aria-selected","true"),""===apexSpotlight.gKeywords?g=apexSpotlight.gPlaceholderText:0===h?g=apexSpotlight.gNoMatchText:1===h?g=apexSpotlight.gOneMatchText:h>1&&(g=h+" "+apexSpotlight.gMultipleMatchesText),g=p+", "+g,$("#"+apexSpotlight.SP_LIVE_REGION).text(g),e.attr("aria-activedescendant",a).attr("aria-expanded",l)},closeDialog:function(){$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).dialog("close")},resetSpotlight:function(){$("#"+apexSpotlight.SP_LIST).empty(),$(apexSpotlight.DOT+apexSpotlight.SP_INPUT).val("").focus(),apexSpotlight.gKeywords="",apexSpotlight.handleAriaAttr()},goTo:function(t,e){var a=t.data("url");switch(t.data("type")){case apexSpotlight.URL_TYPES.searchPage:apexSpotlight.inPageSearch();break;case apexSpotlight.URL_TYPES.redirect:apex.navigation.redirect(a)}apexSpotlight.closeDialog()},getMarkup:function(t){var e=t.title,a=t.desc||"",i=t.url,p=t.type,o=t.icon,l=t.shortcut,g=l?'<span class="'+apexSpotlight.SP_SHORTCUT+'" >'+l+"</span>":"",h="",n="";return(0===i||i)&&(h='data-url="'+i+'" '),p&&(h=h+' data-type="'+p+'" '),n=o.startsWith("fa-")?"fa "+o:o.startsWith("icon-")?"a-Icon "+o:"a-Icon icon-search",'<li class="apx-Spotlight-result apx-Spotlight-result--page"><span class="apx-Spotlight-link" '+h+'><span class="apx-Spotlight-icon" aria-hidden="true"><span class="'+n+'"></span></span><span class="apx-Spotlight-info"><span class="'+apexSpotlight.SP_RESULT_LABEL+'" role="option">'+e+'</span><span class="apx-Spotlight-desc">'+a+"</span></span>"+g+"</span></li>"},resultsAddOns:function(t){return"Y"==apexSpotlight.gEnableInPageSearch&&t.push({n:apexSpotlight.gInPageSearchText,u:"",i:apexSpotlight.ICONS.page,t:apexSpotlight.URL_TYPES.searchPage,shortcut:"Ctrl + 1"}),t},searchNav:function(t){var e,a,i=[],p=!1,o=t.length,l=function(){return p?i:apexSpotlight.gSearchIndex},g=function(t,e,a){var i,p=100,o=e-1;return 0===t&&0===o?p:(-1===(i=a.indexOf(apexSpotlight.gKeywords))?p=p-t-o-e:p-=i,p)};for(a=0;a<t.length;a++)e=t[a],i=l().filter(function(t,a){var i=t.n.toLowerCase(),p=i.split(" ").length,l=i.search(e);return!(o>p)&&(l>-1?(t.score=g(l,p,i),!0):t.t&&t.t.search(e)>-1?(t.score=1,!0):void 0)}).sort(function(t,e){return e.score-t.score}),p=!0;return function(t){var e,a,i,p,o,l="",g={};for(t.length>apexSpotlight.gMaxNavResult&&(t.length=apexSpotlight.gMaxNavResult),e=0;e<t.length;e++)p=(a=t[e]).shortcut,i=a.t||apexSpotlight.URL_TYPES.redirect,o=a.i||apexSpotlight.ICONS.search,g={title:a.n,desc:a.d,url:a.u,icon:o,type:i},p&&(g.shortcut=p),l+=apexSpotlight.getMarkup(g);return l}(apexSpotlight.resultsAddOns(i))},search:function(t){apexSpotlight.gKeywords=t.trim();var e,a,i=apexSpotlight.gKeywords.split(" "),p=($(apexSpotlight.DOT+apexSpotlight.SP_RESULTS),[]);for(a=0;a<i.length;a++)p.push(new RegExp(apex.util.escapeRegExp(i[a]),"gi"));e=apexSpotlight.searchNav(p),$("#"+apexSpotlight.SP_LIST).html(e).find("li").each(function(t){$(this).find(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("id","sp-result-"+t)}).first().addClass(apexSpotlight.SP_ACTIVE)},createSpotlightDialog:function(t){!function(){var e,a,i,p,o=function(){var t=$("div.apx-Spotlight-results");e=t.outerHeight(),a=$("li.apx-Spotlight-result").outerHeight(),i=t.offset().top,p=e/a};$(window).on("apexwindowresized",function(){o()}),$("body").append('<div class="'+apexSpotlight.SP_DIALOG+'"><div class="apx-Spotlight-body"><div class="apx-Spotlight-search"><div class="apx-Spotlight-icon"><span class="a-Icon icon-search" aria-hidden="true"></span></div><div class="apx-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+apexSpotlight.SP_LIST+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+apexSpotlight.SP_INPUT+'" placeholder="'+t+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="'+apexSpotlight.SP_LIVE_REGION+'"></div></div><div class="'+apexSpotlight.SP_RESULTS+'"><ul class="apx-Spotlight-resultsList" id="'+apexSpotlight.SP_LIST+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",apexSpotlight.DOT+apexSpotlight.SP_INPUT,function(){var t=$(this).val().trim(),e=t.length;0===e?apexSpotlight.resetSpotlight():(e>1||!isNaN(t))&&t!==apexSpotlight.gKeywords&&apexSpotlight.search(t)}).on("keydown",apexSpotlight.DOT+apexSpotlight.SP_DIALOG,function(t){var l,g,h=$(apexSpotlight.DOT+apexSpotlight.SP_RESULTS);switch(t.which){case apexSpotlight.KEYS.DOWN:t.preventDefault(),function(t){var i=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE),l=i.index();p||o(),!i.length||i.is(":last-child")?(i.removeClass(apexSpotlight.SP_ACTIVE),t.find("li").first().addClass(apexSpotlight.SP_ACTIVE),t.animate({scrollTop:0})):function(t){if(t[0]){var a=t.offset().top;return a<0||a>e}}(i.removeClass(apexSpotlight.SP_ACTIVE).next().addClass(apexSpotlight.SP_ACTIVE))&&t.animate({scrollTop:(l-p+2)*a},0)}(h);break;case apexSpotlight.KEYS.UP:t.preventDefault(),function(t){var l=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE),g=l.index();p||o(),!t.length||l.is(":first-child")?(l.removeClass(apexSpotlight.SP_ACTIVE),t.find("li").last().addClass(apexSpotlight.SP_ACTIVE),t.animate({scrollTop:t.find("li").length*a})):function(t){if(t[0]){var a=t.offset().top;return a>e||a<=i}}(l.removeClass(apexSpotlight.SP_ACTIVE).prev().addClass(apexSpotlight.SP_ACTIVE))&&t.animate({scrollTop:(g-1)*a},0)}(h);break;case apexSpotlight.KEYS.ENTER:t.preventDefault(),apexSpotlight.goTo(h.find("li.is-active span"),t);break;case apexSpotlight.KEYS.TAB:apexSpotlight.closeDialog()}if(t.ctrlKey){switch(l=h.find(apexSpotlight.DOT+apexSpotlight.SP_SHORTCUT).parent().get().reverse(),t.which){case 49:g=1;break;case 50:g=2;break;case 51:g=3;break;case 52:g=4}g&&apexSpotlight.goTo($(l[g-1]),t)}t.shiftKey&&t.which===apexSpotlight.KEYS.TAB&&apexSpotlight.closeDialog(),apexSpotlight.handleAriaAttr()}).on("click","span.apx-Spotlight-link",function(t){apexSpotlight.goTo($(this),t)}).on("mousemove","li.apx-Spotlight-result",function(){var t=$(this);t.parent().find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE).removeClass(apexSpotlight.SP_ACTIVE),t.addClass(apexSpotlight.SP_ACTIVE)}).on("blur",apexSpotlight.DOT+apexSpotlight.SP_DIALOG,function(t){$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).dialog("isOpen")&&$(apexSpotlight.DOT+apexSpotlight.SP_INPUT).focus()}),$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).on("keydown",function(t){var e=$(apexSpotlight.DOT+apexSpotlight.SP_INPUT);t.which===apexSpotlight.KEYS.ESCAPE&&(e.val()?(apexSpotlight.resetSpotlight(),t.stopPropagation()):apexSpotlight.closeDialog())}),apexSpotlight.gHasDialogCreated=!0}()},openSpotlightDialog:function(t){if(window.self!==window.top)return!1;apexSpotlight.gHasDialogCreated=$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).length>0;var e=function(){var t=$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG),e=window.scrollY||window.pageYOffset;t.hasClass("ui-dialog-content")&&t.dialog("isOpen")||t.dialog({width:apexSpotlight.gWidth,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(e+64),of:$("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){apex.event.trigger("body","apexspotlight-open-dialog");$(this).css("min-height","auto").prev(".ui-dialog-titlebar").remove(),apex.navigation.beginFreezeScroll(),$(".ui-widget-overlay").on("click",function(){apexSpotlight.closeDialog()})},close:function(){apex.event.trigger("body","apexspotlight-close-dialog"),apexSpotlight.resetSpotlight(),apex.navigation.endFreezeScroll()}})};apexSpotlight.gHasDialogCreated?e():(apexSpotlight.createSpotlightDialog(apexSpotlight.gPlaceholderText),e(),apexSpotlight.getSpotlightData(function(t){apexSpotlight.gSearchIndex=t})),focusElement=t},openSpotlightDialogKeyboardShortcut:function(t){Mousetrap.bind(apexSpotlight.gKeyboardShortcutsArray,function(e){apexSpotlight.openSpotlightDialog(t)})},inPageSearch:function(t){var e=t||apexSpotlight.gKeywords;$("body").unmark({done:function(){apexSpotlight.closeDialog(),apexSpotlight.resetSpotlight(),$("body").mark(e,{}),apex.event.trigger("body","apexspotlight-inpage-search",{keyword:e})}})},pluginHandler:function(){var t=apexSpotlight.gAjaxIdentifier=this.action.ajaxIdentifier,e=apexSpotlight.gPlaceholderText=this.action.attribute01,a=apexSpotlight.gMoreCharsText=this.action.attribute02,i=apexSpotlight.gNoMatchText=this.action.attribute03,p=apexSpotlight.gOneMatchText=this.action.attribute04,o=apexSpotlight.gMultipleMatchesText=this.action.attribute05,l=apexSpotlight.gInPageSearchText=this.action.attribute06,g=this.action.attribute08,h=this.action.attribute09,n=this.action.attribute10,r=apexSpotlight.gEnableInPageSearch=this.action.attribute11,S=apexSpotlight.gMaxNavResult=this.action.attribute12,s=apexSpotlight.gWidth=this.action.attribute13,x=this.action.attribute14;apex.debug.log("apexSpotlight.pluginHandler - ajaxIdentifier",t),apex.debug.log("apexSpotlight.pluginHandler - placeholderText",e),apex.debug.log("apexSpotlight.pluginHandler - moreCharsText",a),apex.debug.log("apexSpotlight.pluginHandler - noMatchText",i),apex.debug.log("apexSpotlight.pluginHandler - oneMatchText",p),apex.debug.log("apexSpotlight.pluginHandler - multipleMatchesText",o),apex.debug.log("apexSpotlight.pluginHandler - inPageSearchText",l),apex.debug.log("apexSpotlight.pluginHandler - enableKeyboardShortcuts",g),apex.debug.log("apexSpotlight.pluginHandler - keyboardShortcuts",h),apex.debug.log("apexSpotlight.pluginHandler - submitItems",n),apex.debug.log("apexSpotlight.pluginHandler - enableInPageSearch",r),apex.debug.log("apexSpotlight.pluginHandler - maxNavResult",S),apex.debug.log("apexSpotlight.pluginHandler - width",s),apex.debug.log("apexSpotlight.pluginHandler - enableDataCache",x),apexSpotlight.gEnableDataCache="Y"==x,n&&(apexSpotlight.gSubmitItemsArray=n.split(",")),"Y"==g&&(apexSpotlight.gKeyboardShortcutsArray=h.split(",")),"Y"==g?apexSpotlight.openSpotlightDialogKeyboardShortcut($("body")):apexSpotlight.openSpotlightDialog($("body"))}};