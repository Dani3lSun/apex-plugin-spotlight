var apexSpotlight={DOT:".",SP_DIALOG:"apx-Spotlight",SP_INPUT:"apx-Spotlight-input",SP_RESULTS:"apx-Spotlight-results",SP_ACTIVE:"is-active",SP_SHORTCUT:"apx-Spotlight-shortcut",SP_ACTION_SHORTCUT:"spotlight-search",SP_RESULT_LABEL:"apx-Spotlight-label",SP_LIVE_REGION:"sp-aria-match-found",SP_LIST:"sp-result-list",KEYS:$.ui.keyCode,URL_TYPES:{redirect:"redirect",searchPage:"search-page"},ICONS:{page:"fa-window-search",search:"icon-search"},gMaxNavResult:50,gWidth:650,gHasDialogCreated:!1,gSearchIndex:[],gStaticIndex:[],gKeywords:"",gAjaxIdentifier:null,gPlaceholderText:null,gMoreCharsText:null,gNoMatchText:null,gOneMatchText:null,gMultipleMatchesText:null,gInPageSearchText:null,gEnableInPageSearch:!0,gEnableDataCache:!1,gSubmitItemsArray:[],gKeyboardShortcutsArray:[],getSpotlightData:function(t){var e;if(apexSpotlight.gEnableDataCache&&(e=apexSpotlight.getSpotlightDataSessionStorage()))t(JSON.parse(e));else try{apex.server.plugin(apexSpotlight.gAjaxIdentifier,{pageItems:apexSpotlight.gSubmitItemsArray,x01:"GET_DATA"},{dataType:"json",success:function(e){apex.event.trigger("body","apexspotlight-ajax-success",e),apex.debug.log("apexSpotlight.getSpotlightData AJAX Success",e),apexSpotlight.gEnableDataCache&&apexSpotlight.setSpotlightDataSessionStorage(JSON.stringify(e)),t(e)},error:function(e,a){apex.event.trigger("body","apexspotlight-ajax-error",{message:a}),apex.debug.log("apexSpotlight.getSpotlightData AJAX Error",a),t([])}})}catch(e){apex.event.trigger("body","apexspotlight-ajax-error",{message:e}),apex.debug.log("apexSpotlight.getSpotlightData AJAX Error",e),t([])}},getProperApexUrl:function(t,e){try{apex.server.plugin(apexSpotlight.gAjaxIdentifier,{x01:"GET_URL",x02:apexSpotlight.gKeywords,x03:t},{dataType:"json",success:function(t){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Success",t),e(t)},error:function(a,p){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Error",p),e({url:t})}})}catch(a){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Error",a),e({url:t})}},setSpotlightDataSessionStorage:function(t){if(apex.storage.hasSessionStorageSupport){var e=$v("pInstance");apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).setItem(e+".data",t)}},getSpotlightDataSessionStorage:function(){var t;if(apex.storage.hasSessionStorageSupport){var e=$v("pInstance");t=apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).getItem(e+".data")}return t},handleAriaAttr:function(){var t=$(apexSpotlight.DOT+apexSpotlight.SP_RESULTS),e=$(apexSpotlight.DOT+apexSpotlight.SP_INPUT),a=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE).find(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("id"),p=$("#"+a),i=p.text(),o=t.find("li"),l=0!==o.length,g="",r=o.filter(function(){return 0===$(this).find(apexSpotlight.DOT+apexSpotlight.SP_SHORTCUT).length}).length;$(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("aria-selected","false"),p.attr("aria-selected","true"),""===apexSpotlight.gKeywords?g=apexSpotlight.gPlaceholderText:0===r?g=apexSpotlight.gNoMatchText:1===r?g=apexSpotlight.gOneMatchText:r>1&&(g=r+" "+apexSpotlight.gMultipleMatchesText),g=i+", "+g,$("#"+apexSpotlight.SP_LIVE_REGION).text(g),e.attr("aria-activedescendant",a).attr("aria-expanded",l)},closeDialog:function(){$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).dialog("close")},resetSpotlight:function(){$("#"+apexSpotlight.SP_LIST).empty(),$(apexSpotlight.DOT+apexSpotlight.SP_INPUT).val("").focus(),apexSpotlight.gKeywords="",apexSpotlight.handleAriaAttr()},goTo:function(t,e){var a=t.data("url");switch(t.data("type")){case apexSpotlight.URL_TYPES.searchPage:apexSpotlight.inPageSearch();break;case apexSpotlight.URL_TYPES.redirect:a.includes("~SEARCH_VALUE~")?a.startsWith("f?p=")?apexSpotlight.getProperApexUrl(a,function(t){apex.navigation.redirect(t.url)}):(a=a.replace("~SEARCH_VALUE~",apexSpotlight.gKeywords),apex.navigation.redirect(a)):apex.navigation.redirect(a)}apexSpotlight.closeDialog()},getMarkup:function(t){var e=t.title,a=t.desc||"",p=t.url,i=t.type,o=t.icon,l=t.shortcut,g=l?'<span class="'+apexSpotlight.SP_SHORTCUT+'" >'+l+"</span>":"",r="",n="";return(0===p||p)&&(r='data-url="'+p+'" '),i&&(r=r+' data-type="'+i+'" '),n=o.startsWith("fa-")?"fa "+o:o.startsWith("icon-")?"a-Icon "+o:"a-Icon icon-search",'<li class="apx-Spotlight-result apx-Spotlight-result--page"><span class="apx-Spotlight-link" '+r+'><span class="apx-Spotlight-icon" aria-hidden="true"><span class="'+n+'"></span></span><span class="apx-Spotlight-info"><span class="'+apexSpotlight.SP_RESULT_LABEL+'" role="option">'+e+'</span><span class="apx-Spotlight-desc">'+a+"</span></span>"+g+"</span></li>"},resultsAddOns:function(t){var e=0;"Y"==apexSpotlight.gEnableInPageSearch&&(t.push({n:apexSpotlight.gInPageSearchText,u:"",i:apexSpotlight.ICONS.page,t:apexSpotlight.URL_TYPES.searchPage,shortcut:"Ctrl + 1"}),e+=1);for(var a=0;a<apexSpotlight.gStaticIndex.length;a++)(e+=1)>4?t.push({n:apexSpotlight.gStaticIndex[a].n,u:apexSpotlight.gStaticIndex[a].u,i:apexSpotlight.gStaticIndex[a].i,t:apexSpotlight.gStaticIndex[a].t}):t.push({n:apexSpotlight.gStaticIndex[a].n,u:apexSpotlight.gStaticIndex[a].u,i:apexSpotlight.gStaticIndex[a].i,t:apexSpotlight.gStaticIndex[a].t,shortcut:"Ctrl + "+e});return t},searchNav:function(t){var e,a,p=[],i=!1,o=t.length,l=function(){return i?p:apexSpotlight.gSearchIndex},g=function(t,e,a){var p,i=100,o=e-1;return 0===t&&0===o?i:(-1===(p=a.indexOf(apexSpotlight.gKeywords))?i=i-t-o-e:i-=p,i)};for(a=0;a<t.length;a++)e=t[a],p=l().filter(function(t,a){var p=t.n.toLowerCase(),i=p.split(" ").length,l=p.search(e);return!(o>i)&&(l>-1?(t.score=g(l,i,p),!0):t.t&&t.t.search(e)>-1?(t.score=1,!0):void 0)}).sort(function(t,e){return e.score-t.score}),i=!0;return function(t){var e,a,p,i,o,l="",g={};for(t.length>apexSpotlight.gMaxNavResult&&(t.length=apexSpotlight.gMaxNavResult),e=0;e<t.length;e++)i=(a=t[e]).shortcut,p=a.t||apexSpotlight.URL_TYPES.redirect,o=a.i||apexSpotlight.ICONS.search,g={title:a.n,desc:a.d,url:a.u,icon:o,type:p},i&&(g.shortcut=i),l+=apexSpotlight.getMarkup(g);return l}(apexSpotlight.resultsAddOns(p))},search:function(t){apexSpotlight.gKeywords=t.trim();var e,a,p=apexSpotlight.gKeywords.split(" "),i=($(apexSpotlight.DOT+apexSpotlight.SP_RESULTS),[]);for(a=0;a<p.length;a++)i.push(new RegExp(apex.util.escapeRegExp(p[a]),"gi"));e=apexSpotlight.searchNav(i),$("#"+apexSpotlight.SP_LIST).html(e).find("li").each(function(t){$(this).find(apexSpotlight.DOT+apexSpotlight.SP_RESULT_LABEL).attr("id","sp-result-"+t)}).first().addClass(apexSpotlight.SP_ACTIVE)},createSpotlightDialog:function(t){!function(){var e,a,p,i,o=function(){var t=$("div.apx-Spotlight-results");e=t.outerHeight(),a=$("li.apx-Spotlight-result").outerHeight(),p=t.offset().top,i=e/a};$(window).on("apexwindowresized",function(){o()}),$("body").append('<div class="'+apexSpotlight.SP_DIALOG+'"><div class="apx-Spotlight-body"><div class="apx-Spotlight-search"><div class="apx-Spotlight-icon"><span class="a-Icon icon-search" aria-hidden="true"></span></div><div class="apx-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+apexSpotlight.SP_LIST+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+apexSpotlight.SP_INPUT+'" placeholder="'+t+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="'+apexSpotlight.SP_LIVE_REGION+'"></div></div><div class="'+apexSpotlight.SP_RESULTS+'"><ul class="apx-Spotlight-resultsList" id="'+apexSpotlight.SP_LIST+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",apexSpotlight.DOT+apexSpotlight.SP_INPUT,function(){var t=$(this).val().trim(),e=t.length;0===e?apexSpotlight.resetSpotlight():(e>1||!isNaN(t))&&t!==apexSpotlight.gKeywords&&apexSpotlight.search(t)}).on("keydown",apexSpotlight.DOT+apexSpotlight.SP_DIALOG,function(t){var l,g,r=$(apexSpotlight.DOT+apexSpotlight.SP_RESULTS);switch(t.which){case apexSpotlight.KEYS.DOWN:t.preventDefault(),function(t){var p=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE),l=p.index();i||o(),!p.length||p.is(":last-child")?(p.removeClass(apexSpotlight.SP_ACTIVE),t.find("li").first().addClass(apexSpotlight.SP_ACTIVE),t.animate({scrollTop:0})):function(t){if(t[0]){var a=t.offset().top;return a<0||a>e}}(p.removeClass(apexSpotlight.SP_ACTIVE).next().addClass(apexSpotlight.SP_ACTIVE))&&t.animate({scrollTop:(l-i+2)*a},0)}(r);break;case apexSpotlight.KEYS.UP:t.preventDefault(),function(t){var l=t.find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE),g=l.index();i||o(),!t.length||l.is(":first-child")?(l.removeClass(apexSpotlight.SP_ACTIVE),t.find("li").last().addClass(apexSpotlight.SP_ACTIVE),t.animate({scrollTop:t.find("li").length*a})):function(t){if(t[0]){var a=t.offset().top;return a>e||a<=p}}(l.removeClass(apexSpotlight.SP_ACTIVE).prev().addClass(apexSpotlight.SP_ACTIVE))&&t.animate({scrollTop:(g-1)*a},0)}(r);break;case apexSpotlight.KEYS.ENTER:t.preventDefault(),apexSpotlight.goTo(r.find("li.is-active span"),t);break;case apexSpotlight.KEYS.TAB:apexSpotlight.closeDialog()}if(t.ctrlKey){switch(l=r.find(apexSpotlight.DOT+apexSpotlight.SP_SHORTCUT).parent().get(),t.which){case 49:g=1;break;case 50:g=2;break;case 51:g=3;break;case 52:g=4}g&&apexSpotlight.goTo($(l[g-1]),t)}t.shiftKey&&t.which===apexSpotlight.KEYS.TAB&&apexSpotlight.closeDialog(),apexSpotlight.handleAriaAttr()}).on("click","span.apx-Spotlight-link",function(t){apexSpotlight.goTo($(this),t)}).on("mousemove","li.apx-Spotlight-result",function(){var t=$(this);t.parent().find(apexSpotlight.DOT+apexSpotlight.SP_ACTIVE).removeClass(apexSpotlight.SP_ACTIVE),t.addClass(apexSpotlight.SP_ACTIVE)}).on("blur",apexSpotlight.DOT+apexSpotlight.SP_DIALOG,function(t){$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).dialog("isOpen")&&$(apexSpotlight.DOT+apexSpotlight.SP_INPUT).focus()}),$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).on("keydown",function(t){var e=$(apexSpotlight.DOT+apexSpotlight.SP_INPUT);t.which===apexSpotlight.KEYS.ESCAPE&&(e.val()?(apexSpotlight.resetSpotlight(),t.stopPropagation()):apexSpotlight.closeDialog())}),apexSpotlight.gHasDialogCreated=!0}()},openSpotlightDialog:function(t){if(window.self!==window.top)return!1;apexSpotlight.gHasDialogCreated=$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG).length>0;var e=function(){var t=$(apexSpotlight.DOT+apexSpotlight.SP_DIALOG),e=window.scrollY||window.pageYOffset;t.hasClass("ui-dialog-content")&&t.dialog("isOpen")||t.dialog({width:apexSpotlight.gWidth,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(e+64),of:$("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){apex.event.trigger("body","apexspotlight-open-dialog");$(this).css("min-height","auto").prev(".ui-dialog-titlebar").remove(),apex.navigation.beginFreezeScroll(),$(".ui-widget-overlay").on("click",function(){apexSpotlight.closeDialog()})},close:function(){apex.event.trigger("body","apexspotlight-close-dialog"),apexSpotlight.resetSpotlight(),apex.navigation.endFreezeScroll()}})};apexSpotlight.gHasDialogCreated?e():(apexSpotlight.createSpotlightDialog(apexSpotlight.gPlaceholderText),e(),apexSpotlight.getSpotlightData(function(t){apexSpotlight.gSearchIndex=$.grep(t,function(t){return 0==t.s}),apexSpotlight.gStaticIndex=$.grep(t,function(t){return 1==t.s})})),focusElement=t},openSpotlightDialogKeyboardShortcut:function(t){Mousetrap.bind(apexSpotlight.gKeyboardShortcutsArray,function(e){apexSpotlight.openSpotlightDialog(t)})},inPageSearch:function(t){var e=t||apexSpotlight.gKeywords;$("body").unmark({done:function(){apexSpotlight.closeDialog(),apexSpotlight.resetSpotlight(),$("body").mark(e,{}),apex.event.trigger("body","apexspotlight-inpage-search",{keyword:e})}})},pluginHandler:function(){var t=apexSpotlight.gAjaxIdentifier=this.action.ajaxIdentifier,e=apexSpotlight.gPlaceholderText=this.action.attribute01,a=apexSpotlight.gMoreCharsText=this.action.attribute02,p=apexSpotlight.gNoMatchText=this.action.attribute03,i=apexSpotlight.gOneMatchText=this.action.attribute04,o=apexSpotlight.gMultipleMatchesText=this.action.attribute05,l=apexSpotlight.gInPageSearchText=this.action.attribute06,g=this.action.attribute08,r=this.action.attribute09,n=this.action.attribute10,h=apexSpotlight.gEnableInPageSearch=this.action.attribute11,S=apexSpotlight.gMaxNavResult=this.action.attribute12,s=apexSpotlight.gWidth=this.action.attribute13,x=this.action.attribute14;apex.debug.log("apexSpotlight.pluginHandler - ajaxIdentifier",t),apex.debug.log("apexSpotlight.pluginHandler - placeholderText",e),apex.debug.log("apexSpotlight.pluginHandler - moreCharsText",a),apex.debug.log("apexSpotlight.pluginHandler - noMatchText",p),apex.debug.log("apexSpotlight.pluginHandler - oneMatchText",i),apex.debug.log("apexSpotlight.pluginHandler - multipleMatchesText",o),apex.debug.log("apexSpotlight.pluginHandler - inPageSearchText",l),apex.debug.log("apexSpotlight.pluginHandler - enableKeyboardShortcuts",g),apex.debug.log("apexSpotlight.pluginHandler - keyboardShortcuts",r),apex.debug.log("apexSpotlight.pluginHandler - submitItems",n),apex.debug.log("apexSpotlight.pluginHandler - enableInPageSearch",h),apex.debug.log("apexSpotlight.pluginHandler - maxNavResult",S),apex.debug.log("apexSpotlight.pluginHandler - width",s),apex.debug.log("apexSpotlight.pluginHandler - enableDataCache",x),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t}),String.prototype.includes||(String.prototype.includes=function(t,e){"use strict";return"number"!=typeof e&&(e=0),!(e+t.length>this.length)&&-1!==this.indexOf(t,e)}),apexSpotlight.gEnableDataCache="Y"==x,n&&(apexSpotlight.gSubmitItemsArray=n.split(",")),"Y"==g&&(apexSpotlight.gKeyboardShortcutsArray=r.split(",")),"Y"==g?apexSpotlight.openSpotlightDialogKeyboardShortcut($("body")):apexSpotlight.openSpotlightDialog($("body"))}};