apex.da.apexSpotlight={initKeyboardShortcuts:function(t){t.eventName="keyboardShortcut",apex.debug.log("apexSpotlight.initKeyBoardShortcuts - pOptions",t);var e=t.enableKeyboardShortcuts,a=t.keyboardShortcuts,i=[];"Y"==e&&(i=a.split(","),Mousetrap.stopCallback=function(e,t,a){return!1},Mousetrap.prototype.stopCallback=function(e,t,a){return!1},Mousetrap.bind(i,function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,apex.da.apexSpotlight.pluginHandler(t)}))},pluginHandler:function(e){var D={DOT:".",SP_DIALOG:"apx-Spotlight",SP_INPUT:"apx-Spotlight-input",SP_RESULTS:"apx-Spotlight-results",SP_ACTIVE:"is-active",SP_SHORTCUT:"apx-Spotlight-shortcut",SP_ACTION_SHORTCUT:"spotlight-search",SP_RESULT_LABEL:"apx-Spotlight-label",SP_LIVE_REGION:"sp-aria-match-found",SP_LIST:"sp-result-list",KEYS:$.ui.keyCode,URL_TYPES:{redirect:"redirect",searchPage:"search-page"},ICONS:{page:"fa-window-search",search:"icon-search"},gMaxNavResult:50,gWidth:650,gHasDialogCreated:!1,gSearchIndex:[],gStaticIndex:[],gKeywords:"",gAjaxIdentifier:null,gDynamicActionId:null,gPlaceholderText:null,gMoreCharsText:null,gNoMatchText:null,gOneMatchText:null,gMultipleMatchesText:null,gInPageSearchText:null,gEnableInPageSearch:!0,gEnableDataCache:!1,gEnablePrefillSelectedText:!1,gSubmitItemsArray:[],gResultListThemeClass:"",gIconThemeClass:"",gShowProcessing:!1,gPlaceHolderIcon:"a-Icon icon-search",gWaitSpinner$:null,getSpotlightData:function(i){var e;if(D.gEnableDataCache&&(e=D.getSpotlightDataSessionStorage()))i(JSON.parse(e));else try{D.showWaitSpinner(),apex.server.plugin(D.gAjaxIdentifier,{pageItems:D.gSubmitItemsArray,x01:"GET_DATA"},{dataType:"json",success:function(e){apex.event.trigger("body","apexspotlight-ajax-success",e),apex.debug.log("apexSpotlight.getSpotlightData AJAX Success",e),D.gEnableDataCache&&D.setSpotlightDataSessionStorage(JSON.stringify(e)),D.hideWaitSpinner(),i(e)},error:function(e,t,a){apex.event.trigger("body","apexspotlight-ajax-error",{message:a}),apex.debug.log("apexSpotlight.getSpotlightData AJAX Error",a),D.hideWaitSpinner(),i([])}})}catch(e){apex.event.trigger("body","apexspotlight-ajax-error",{message:e}),apex.debug.log("apexSpotlight.getSpotlightData AJAX Error",e),D.hideWaitSpinner(),i([])}},getProperApexUrl:function(i,n){try{apex.server.plugin(D.gAjaxIdentifier,{x01:"GET_URL",x02:D.gKeywords,x03:i},{dataType:"json",success:function(e){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Success",e),n(e)},error:function(e,t,a){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Error",a),n({url:i})}})}catch(e){apex.debug.log("apexSpotlight.getProperApexUrl AJAX Error",e),n({url:i})}},setSpotlightDataSessionStorage:function(e){if(apex.storage.hasSessionStorageSupport){var t=$v("pInstance");apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).setItem(t+"."+D.gDynamicActionId+".data",e)}},getSpotlightDataSessionStorage:function(){var e;if(apex.storage.hasSessionStorageSupport){var t=$v("pInstance");e=apex.storage.getScopedSessionStorage({prefix:"apexSpotlight",useAppId:!0}).getItem(t+"."+D.gDynamicActionId+".data")}return e},showWaitSpinner:function(){D.gShowProcessing&&$("div.apx-Spotlight-icon span").removeClass().addClass("fa fa-refresh fa-anim-spin")},hideWaitSpinner:function(){D.gShowProcessing&&$("div.apx-Spotlight-icon span").removeClass().addClass(D.gPlaceHolderIcon)},getSelectedText:function(){return window.getSelection?window.getSelection().toString().trim():document.selection.createRange?document.selection.createRange().text.trim():void 0},setSelectedText:function(){var e=D.getSelectedText();e&&(D.gHasDialogCreated?$(D.DOT+D.SP_INPUT).val(e).trigger("input"):$("body").on("apexspotlight-get-data",function(){$(D.DOT+D.SP_INPUT).val(e).trigger("input")}))},redirect:function(t){if(D.gShowProcessing)try{t.startsWith("javascript:")||0==$("span.u-Processing").length&&t.startsWith("f?p=")&&apex.page.validate()&&!apex.page.isChanged()&&(D.gWaitSpinner$=apex.util.showSpinner($("body"))),apex.navigation.redirect(t)}catch(e){D.gWaitSpinner$&&D.gWaitSpinner$.remove(),apex.navigation.redirect(t)}else apex.navigation.redirect(t)},handleAriaAttr:function(){var e=$(D.DOT+D.SP_RESULTS),t=$(D.DOT+D.SP_INPUT),a=e.find(D.DOT+D.SP_ACTIVE).find(D.DOT+D.SP_RESULT_LABEL).attr("id"),i=$("#"+a),n=i.text(),o=e.find("li"),r=0!==o.length,l="",s=o.filter(function(){return 0===$(this).find(D.DOT+D.SP_SHORTCUT).length}).length;$(D.DOT+D.SP_RESULT_LABEL).attr("aria-selected","false"),i.attr("aria-selected","true"),""===D.gKeywords?l=D.gMoreCharsText:0===s?l=D.gNoMatchText:1===s?l=D.gOneMatchText:1<s&&(l=s+" "+D.gMultipleMatchesText),l=n+", "+l,$("#"+D.SP_LIVE_REGION).text(l),t.attr("aria-activedescendant",a).attr("aria-expanded",r)},closeDialog:function(){$(D.DOT+D.SP_DIALOG).dialog("close")},resetSpotlight:function(){$("#"+D.SP_LIST).empty(),$(D.DOT+D.SP_INPUT).val("").focus(),D.gKeywords="",D.handleAriaAttr()},goTo:function(e,t){var a=e.data("url");switch(e.data("type")){case D.URL_TYPES.searchPage:D.inPageSearch();break;case D.URL_TYPES.redirect:a.includes("~SEARCH_VALUE~")?(D.gKeywords=D.gKeywords.replace(/:|,|"|'/g," ").trim(),a.startsWith("f?p=")?D.getProperApexUrl(a,function(e){D.redirect(e.url)}):(a=a.replace("~SEARCH_VALUE~",D.gKeywords),D.redirect(a))):D.redirect(a)}D.closeDialog()},getMarkup:function(e){var t=e.title,a=e.desc||"",i=e.url,n=e.type,o=e.icon,r=e.iconColor,l=e.shortcut,s=e.static,g=l?'<span class="'+D.SP_SHORTCUT+'" >'+l+"</span>":"",p="",c="",d="",h="";return(0===i||i)&&(p='data-url="'+i+'" '),n&&(p=p+' data-type="'+n+'" '),c=o.startsWith("fa-")?"fa "+o:o.startsWith("icon-")?"a-Icon "+o:"a-Icon icon-search",d=s?"STATIC":"DYNAMIC",r&&(h='style="background-color:'+r+'"'),'<li class="apx-Spotlight-result '+D.gResultListThemeClass+" apx-Spotlight-result--page apx-Spotlight-"+d+'"><span class="apx-Spotlight-link" '+p+'><span class="apx-Spotlight-icon '+D.gIconThemeClass+'" '+h+' aria-hidden="true"><span class="'+c+'"></span></span><span class="apx-Spotlight-info"><span class="'+D.SP_RESULT_LABEL+'" role="option">'+t+'</span><span class="apx-Spotlight-desc">'+a+"</span></span>"+g+"</span></li>"},resultsAddOns:function(e){var t=0;D.gEnableInPageSearch&&(e.push({n:D.gInPageSearchText,u:"",i:D.ICONS.page,ic:null,t:D.URL_TYPES.searchPage,shortcut:"Ctrl + 1",s:!0}),t+=1);for(var a=0;a<D.gStaticIndex.length;a++)9<(t+=1)?e.push({n:D.gStaticIndex[a].n,d:D.gStaticIndex[a].d,u:D.gStaticIndex[a].u,i:D.gStaticIndex[a].i,ic:D.gStaticIndex[a].ic,t:D.gStaticIndex[a].t,s:D.gStaticIndex[a].s}):e.push({n:D.gStaticIndex[a].n,d:D.gStaticIndex[a].d,u:D.gStaticIndex[a].u,i:D.gStaticIndex[a].i,ic:D.gStaticIndex[a].ic,t:D.gStaticIndex[a].t,s:D.gStaticIndex[a].s,shortcut:"Ctrl + "+t});return e},searchNav:function(e){var c,t,a=[],i=!1,d=e.length;for(t=0;t<e.length;t++)c=e[t],a=(i?a:D.gSearchIndex).filter(function(e,t){var a,i,n,o,r,l,s=e.n.toLowerCase(),g=s.split(" ").length,p=s.search(c);return!(g<d)&&(-1<p?(e.score=(n=s,r=100,l=(i=g)-1,0===(a=p)&&0===l||(-1===(o=n.indexOf(D.gKeywords))?r=r-a-l-i:r-=o),r),!0):e.t&&-1<e.t.search(c)?(e.score=1,!0):void 0)}).sort(function(e,t){return t.score-e.score}),i=!0;return function(e){var t,a,i,n,o,r,l,s="",g={};for(e.length>D.gMaxNavResult&&(e.length=D.gMaxNavResult),t=0;t<e.length;t++)n=(a=e[t]).shortcut,i=a.t||D.URL_TYPES.redirect,o=a.i||D.ICONS.search,l=a.s||!1,"DEFAULT"!==a.ic&&(r=a.ic),g={title:a.n,desc:a.d,url:a.u,icon:o,iconColor:r,type:i,static:l},n&&(g.shortcut=n),s+=D.getMarkup(g);return s}(D.resultsAddOns(a))},search:function(e){D.gKeywords=e.trim();var t,a,i=D.gKeywords.split(" "),n=($(D.DOT+D.SP_RESULTS),[]);for(a=0;a<i.length;a++)n.push(new RegExp(apex.util.escapeRegExp(i[a]),"gi"));t=D.searchNav(n),$("#"+D.SP_LIST).html(t).find("li").each(function(e){$(this).find(D.DOT+D.SP_RESULT_LABEL).attr("id","sp-result-"+e)}).first().addClass(D.SP_ACTIVE)},createSpotlightDialog:function(e){var i,n,o,r,l,s,g;l=function(){if(0<$(D.DOT+D.SP_DIALOG).length){var e=$("div.apx-Spotlight-results");i=e.outerHeight(),n=$("li.apx-Spotlight-result").outerHeight(),o=e.offset().top,r=i/n}},s=function(e){var t=e.find(D.DOT+D.SP_ACTIVE),a=t.index();r||l(),!t.length||t.is(":last-child")?(t.removeClass(D.SP_ACTIVE),e.find("li").first().addClass(D.SP_ACTIVE),e.animate({scrollTop:0})):function(e){if(e[0]){var t=e.offset().top;return t<0||i<t}}(t.removeClass(D.SP_ACTIVE).next().addClass(D.SP_ACTIVE))&&e.animate({scrollTop:(a-r+2)*n},0)},g=function(e){var t=e.find(D.DOT+D.SP_ACTIVE),a=t.index();r||l(),!e.length||t.is(":first-child")?(t.removeClass(D.SP_ACTIVE),e.find("li").last().addClass(D.SP_ACTIVE),e.animate({scrollTop:e.find("li").length*n})):function(e){if(e[0]){var t=e.offset().top;return i<t||t<=o}}(t.removeClass(D.SP_ACTIVE).prev().addClass(D.SP_ACTIVE))&&e.animate({scrollTop:(a-1)*n},0)},$(window).on("apexwindowresized",function(){l()}),$("body").append('<div class="'+D.SP_DIALOG+'" data-id="'+D.gDynamicActionId+'"><div class="apx-Spotlight-body"><div class="apx-Spotlight-search"><div class="apx-Spotlight-icon"><span class="'+D.gPlaceHolderIcon+'" aria-hidden="true"></span></div><div class="apx-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+D.SP_LIST+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+D.SP_INPUT+'" placeholder="'+e+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="'+D.SP_LIVE_REGION+'"></div></div><div class="'+D.SP_RESULTS+'"><ul class="apx-Spotlight-resultsList" id="'+D.SP_LIST+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",D.DOT+D.SP_INPUT,function(){var e=$(this).val().trim(),t=e.length;0===t?D.resetSpotlight():(1<t||!isNaN(e))&&e!==D.gKeywords&&D.search(e)}).on("keydown",D.DOT+D.SP_DIALOG,function(e){var t,a,i=$(D.DOT+D.SP_RESULTS);switch(e.which){case D.KEYS.DOWN:e.preventDefault(),s(i);break;case D.KEYS.UP:e.preventDefault(),g(i);break;case D.KEYS.ENTER:e.preventDefault(),D.goTo(i.find("li.is-active span"),e);break;case D.KEYS.TAB:D.closeDialog()}if(e.ctrlKey){switch(t=i.find(D.DOT+D.SP_SHORTCUT).parent().get(),e.which){case 49:a=1;break;case 50:a=2;break;case 51:a=3;break;case 52:a=4;break;case 53:a=5;break;case 54:a=6;break;case 55:a=7;break;case 56:a=8;break;case 57:a=9}a&&D.goTo($(t[a-1]),e)}e.shiftKey&&e.which===D.KEYS.TAB&&D.closeDialog(),D.handleAriaAttr()}).on("click","span.apx-Spotlight-link",function(e){D.goTo($(this),e)}).on("mousemove","li.apx-Spotlight-result",function(){var e=$(this);e.parent().find(D.DOT+D.SP_ACTIVE).removeClass(D.SP_ACTIVE),e.addClass(D.SP_ACTIVE)}).on("blur",D.DOT+D.SP_DIALOG,function(e){$(D.DOT+D.SP_DIALOG).dialog("isOpen")&&$(D.DOT+D.SP_INPUT).focus()}),$(D.DOT+D.SP_DIALOG).on("keydown",function(e){var t=$(D.DOT+D.SP_INPUT);e.which===D.KEYS.ESCAPE&&(t.val()?(D.resetSpotlight(),e.stopPropagation()):D.closeDialog())}),D.gHasDialogCreated=!0},openSpotlightDialog:function(e){if(window.self!==window.top)return!1;D.gHasDialogCreated=0<$(D.DOT+D.SP_DIALOG).length,D.gHasDialogCreated&&$(D.DOT+D.SP_DIALOG).attr("data-id")!=D.gDynamicActionId&&(D.resetSpotlight(),$(D.DOT+D.SP_DIALOG).remove(),D.gHasDialogCreated=!1),D.gEnablePrefillSelectedText&&D.setSelectedText();var t=function(){var e=$(D.DOT+D.SP_DIALOG),t=window.scrollY||window.pageYOffset;e.hasClass("ui-dialog-content")&&e.dialog("isOpen")||e.dialog({width:D.gWidth,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(t+64),of:$("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){apex.event.trigger("body","apexspotlight-open-dialog"),$(this).css("min-height","auto").prev(".ui-dialog-titlebar").remove(),apex.navigation.beginFreezeScroll(),$(".ui-widget-overlay").on("click",function(){D.closeDialog()})},close:function(){apex.event.trigger("body","apexspotlight-close-dialog"),D.resetSpotlight(),apex.navigation.endFreezeScroll()}})};D.gHasDialogCreated?t():(D.createSpotlightDialog(D.gPlaceholderText),t(),D.getSpotlightData(function(e){D.gSearchIndex=$.grep(e,function(e){return 0==e.s}),D.gStaticIndex=$.grep(e,function(e){return 1==e.s}),apex.event.trigger("body","apexspotlight-get-data",e)})),focusElement=e},inPageSearch:function(e){var t=e||D.gKeywords;$("body").unmark({done:function(){D.closeDialog(),D.resetSpotlight(),$("body").mark(t,{}),apex.event.trigger("body","apexspotlight-inpage-search",{keyword:t})}})},hasSearchResultsDynamicEntries:function(){return $("li.apx-Spotlight-result").hasClass("apx-Spotlight-DYNAMIC")||!1},pluginHandler:function(e){var t=D.gDynamicActionId=e.dynamicActionId,a=D.gAjaxIdentifier=e.ajaxIdentifier,i=e.eventName,n=e.fireOnInit,o=D.gPlaceholderText=e.placeholderText,r=D.gMoreCharsText=e.moreCharsText,l=D.gNoMatchText=e.noMatchText,s=D.gOneMatchText=e.oneMatchText,g=D.gMultipleMatchesText=e.multipleMatchesText,p=D.gInPageSearchText=e.inPageSearchText,c=e.enableKeyboardShortcuts,d=e.keyboardShortcuts,h=e.submitItems,S=e.enableInPageSearch,u=D.gMaxNavResult=e.maxNavResult,x=D.gWidth=e.width,T=e.enableDataCache,f=e.spotlightTheme,I=e.enablePrefillSelectedText,P=e.showProcessing,v=e.placeHolderIcon,b=!0;switch(apex.debug.log("apexSpotlight.pluginHandler - dynamicActionId",t),apex.debug.log("apexSpotlight.pluginHandler - ajaxIdentifier",a),apex.debug.log("apexSpotlight.pluginHandler - eventName",i),apex.debug.log("apexSpotlight.pluginHandler - fireOnInit",n),apex.debug.log("apexSpotlight.pluginHandler - placeholderText",o),apex.debug.log("apexSpotlight.pluginHandler - moreCharsText",r),apex.debug.log("apexSpotlight.pluginHandler - noMatchText",l),apex.debug.log("apexSpotlight.pluginHandler - oneMatchText",s),apex.debug.log("apexSpotlight.pluginHandler - multipleMatchesText",g),apex.debug.log("apexSpotlight.pluginHandler - inPageSearchText",p),apex.debug.log("apexSpotlight.pluginHandler - enableKeyboardShortcuts",c),apex.debug.log("apexSpotlight.pluginHandler - keyboardShortcuts",d),apex.debug.log("apexSpotlight.pluginHandler - submitItems",h),apex.debug.log("apexSpotlight.pluginHandler - enableInPageSearch",S),apex.debug.log("apexSpotlight.pluginHandler - maxNavResult",u),apex.debug.log("apexSpotlight.pluginHandler - width",x),apex.debug.log("apexSpotlight.pluginHandler - enableDataCache",T),apex.debug.log("apexSpotlight.pluginHandler - spotlightTheme",f),apex.debug.log("apexSpotlight.pluginHandler - enablePrefillSelectedText",I),apex.debug.log("apexSpotlight.pluginHandler - showProcessing",P),apex.debug.log("apexSpotlight.pluginHandler - placeHolderIcon",v),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),D.gEnableInPageSearch="Y"==S,D.gEnableDataCache="Y"==T,D.gEnablePrefillSelectedText="Y"==I,D.gShowProcessing="Y"==P,h&&(D.gSubmitItemsArray=h.split(",")),f){case"ORANGE":D.gResultListThemeClass="apx-Spotlight-result-orange",D.gIconThemeClass="apx-Spotlight-icon-orange";break;case"RED":D.gResultListThemeClass="apx-Spotlight-result-red",D.gIconThemeClass="apx-Spotlight-icon-red";break;case"DARK":D.gResultListThemeClass="apx-Spotlight-result-dark",D.gIconThemeClass="apx-Spotlight-icon-dark"}D.gPlaceHolderIcon="DEFAULT"===v?"a-Icon icon-search":"fa "+v,b="keyboardShortcut"==i||"Y"==n||"ready"!=i,$("body").on("apexspotlight-get-data",function(){if(D.gHasDialogCreated&&!D.hasSearchResultsDynamicEntries()){var e=$(D.DOT+D.SP_INPUT).val().trim();e&&(D.search(e),$(D.DOT+D.SP_INPUT).trigger("input"))}}),b&&D.openSpotlightDialog()}};D.pluginHandler(e)}};